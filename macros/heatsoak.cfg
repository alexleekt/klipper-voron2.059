[gcode_macro HEATSOAK]
default_parameter_DURATION=300
default_parameter_TARGET=95
default_parameter_MOVE=1
gcode:
    SAVE_GCODE_STATE
    RESPOND TYPE=command MSG="Heatsoak: {TARGET}c for {DURATION}s"
    M117 Heatsoak: {TARGET}c for {DURATION}s
    M140 S{TARGET}
    {% if MOVE|int == 1 %}
      RESPOND TYPE=command MSG="Heatsoak: Centering over bed."
      G28
      MOVE_TO_CENTER
      M400
    {% endif %}
    RESPOND TYPE=command MSG="Heatsoak: waiting for bed to reach {TARGET}c"
    M117 Heatsoak: waiting for bed {TARGET}c
    M190 S{TARGET}
    {% for i in range(DURATION|int, 0, -1) %}
      {% if i%5==0 %}
        RESPOND TYPE=command MSG="Heatsoak: {i}s"
        M117 Heatsoak: {i}s remaining
      {% endif %}
      G4 P1000
    {% endfor %}
    RESPOND TYPE=command MSG="Heatsoak: complete"
    M117 Heatsoak: complete.
    RESTORE_GCODE_STATE

[gcode_macro HEATSOAK_ABS]
gcode:
    HEATSOAK TARGET=95

[gcode_macro HEATSOAK_TPU]
gcode:
    HEATSOAK TARGET=60

[gcode_macro HEATSOAK_PLA]
gcode:
    HEATSOAK TARGET=60

[gcode_macro HEATSOAK_PETG]
gcode:
    HEATSOAK TARGET=80
